<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Group Account</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- main card -->
  <div class="card" id="mainCard">
    <!-- banner -->
    <div class="banner" id="bannerPreview"></div>

    <!-- profile row with frame display (·Ä°·Äï·Äº·ÄÑ·Ä∫·Äô·Äæ·Ä¨·Äë·ÄØ·Äê·Ä∫·Äï·Äº·Äô·Ää·Ä∫) -->
    <div class="profile-row">
      <div style="position: relative; width: 80px; height: 80px; flex-shrink: 0;">
        <div class="profile-circle" id="profilePreview"></div>
      </div>
      <div class="frame-display" id="frameDisplay"></div>
      <div class="name-wrapper">
        <div class="display-name" id="displayName">Name</div>
      </div>
    </div>

    <!-- role header -->
    <div class="role-header">
      <span>Role</span>
    </div>

    <!-- 6 role squares -->
    <div class="role-grid" id="roleGrid">
      <div class="role-slot" data-index="0">+</div>
      <div class="role-slot" data-index="1">+</div>
      <div class="role-slot" data-index="2">+</div>
      <div class="role-slot" data-index="3">+</div>
      <div class="role-slot" data-index="4">+</div>
      <div class="role-slot" data-index="5">+</div>
    </div>

    <!-- edit section with buttons -->
    <div class="edit-section">
      <div class="edit-btn" id="openEditBtn">EDIT PROFILE</div>
      <div class="edit-frame-btn" id="openFrameBtn"> Edit Frame</div>
      <div class="telegram-btn" id="sendToTelegramBtn">Telegram ·Äû·Ä≠·ÄØ·Ä∑·Äï·ÄØ·Ä∂·Äï·Ä≠·ÄØ·Ä∑·Äô·Ää·Ä∫</div>
    </div>
  </div>

  <!-- MODAL: role selection -->
  <div class="role-modal" id="roleSelectModal">
    <div class="role-modal-content">
      <h3>My PNG Roles</h3>
      <div class="role-list" id="roleListContainer"></div>
      <div class="action-btns">
        <div class="action-btn" id="selectRoleBtn">·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äô·Ää·Ä∫</div>
        <div class="action-btn remove" id="removeRoleBtn">·Äñ·Äº·ÄØ·Äê·Ä∫·Äô·Ää·Ä∫</div>
      </div>
      <div class="cancel-btn" id="closeRoleModalBtn">·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫</div>
    </div>
  </div>

  <!-- EDIT PROFILE MODAL -->
  <div class="edit-modal" id="editProfileModal">
    <div class="edit-modal-content">
      <h3>EDIT PROFILE</h3>

      <!-- card background upload -->
      <div class="edit-field">
        <span class="edit-label">Card Background</span>
        <div class="bg-upload" id="editBgBox">+ ·Äî·Äæ·Ä≠·Äï·Ä∫·Åç·Äï·ÄØ·Ä∂·Äõ·ÄΩ·Ä±·Ä∏</div>
        <input type="file" id="bgFile" accept="image/*" />
      </div>

      <!-- banner -->
      <div class="edit-field">
        <span class="edit-label">Banner</span>
        <div class="edit-upload" id="editBannerBox">+ ·Äî·Äæ·Ä≠·Äï·Ä∫·Åç·Äë·Ää·Ä∑·Ä∫</div>
        <input type="file" id="bannerFile" accept="image/*" />
      </div>

      <!-- profile photo -->
      <div class="edit-field">
        <span class="edit-label">Profile Photo</span>
        <div class="edit-upload" id="editProfileBox" style="border-radius: 50%; max-width: 80px; height: 80px; margin: 0 auto;">+</div>
        <input type="file" id="profileFile" accept="image/*" />
      </div>

      <!-- name field -->
      <div class="edit-field">
        <span class="edit-label">Name</span>
        <input type="text" class="edit-input" id="editNameInput" placeholder="·Äî·Ä¨·Äô·Ää·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´" />
      </div>

      <div class="edit-actions">
        <div class="edit-save" id="saveEditBtn">SAVE</div>
        <div class="edit-close" id="closeEditBtn">CLOSE</div>
      </div>
    </div>
  </div>

  <!-- JavaScript will create these modals dynamically:
       - Role Password Modal
       - Frame Modal
       - Frame Password Modal
  -->

  <script src="script.js"></script>
</body>
</html><style>* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
}

body {
  background: #0a0f19;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px;
}

/* main card */
.card {
  max-width: 340px;
  width: 100%;
  background: #1a2335;
  border-radius: 36px 36px 32px 32px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
  border: 1px solid #35415e;
  overflow: hidden;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* banner */
.banner {
  width: 100%;
  height: 150px;
  background: #1f2b44;
  background-image: radial-gradient(circle at 20% 30%, #33466b 0%, transparent 60%);
  border-bottom: 2px solid #3f5380;
  background-size: cover;
  background-position: center;
}

/* profile row */
.profile-row {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 0 14px;
  margin-top: -38px;
  margin-bottom: 20px;
  position: relative;
}

.profile-circle {
  width: 80px;
  height: 80px;
  background: #26375a;
  border-radius: 50%;
  border: 5px solid #1a2335;
  box-shadow: 0 8px 16px #000000b3;
  background-size: cover;
  background-position: center;
  position: relative;
  z-index: 2;
}

..frame-display {
  position: absolute;

  /* slightly bigger than profile circle */
  width: 90px;
  height: 90px;

  /* move up and left to align perfectly */
  top: -5px;
  left: -1px;

  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;

  pointer-events: none;
  z-index: 5;
}

.name-wrapper {
  flex: 1;
  background: #2b3b64;
  border-radius: 30px;
  padding: 6px 12px;
  box-shadow: 0 4px 0 #121d33;
  border: 1px solid #5a77c0;
  z-index: 5;
}

.display-name {
  color: white;
  font-size: 15px;
  font-weight: 600;
  text-align: center;
  letter-spacing: 0.2px;
  text-shadow: 0 2px 3px black;
}

.role-header {
  text-align: center;
  margin: 8px 0 12px;
}

.role-header span {
  background: #25355a;
  color: #d6e2ff;
  font-size: 14px;
  font-weight: 600;
  padding: 5px 20px;
  border-radius: 40px;
  border: 1px solid #5f7bcb;
  display: inline-block;
  box-shadow: 0 4px 0 #121b30;
}

.role-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  padding: 0 12px;
  margin-bottom: 18px;
}

.role-slot {
  aspect-ratio: 1/1;
  background: #1f2c48;
  border-radius: 22px;
  border: 2px dashed #5f7ed6;
  box-shadow: 0 5px 0 #111a2c;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 28px;
  color: #7c97e6;
  font-weight: 300;
  background-size: cover;
  background-position: center;
}

.role-slot:active {
  transform: translateY(3px);
  box-shadow: 0 2px 0 #111a2c;
}

.edit-section {
  padding: 0 12px 20px 12px;
}

.edit-btn {
  width: 100%;
  background: #253767;
  border: 2px solid #6a89f0;
  color: #f0f5ff;
  font-size: 16px;
  font-weight: 700;
  padding: 14px 0;
  border-radius: 36px;
  text-align: center;
  box-shadow: 0 7px 0 #121c34;
  cursor: pointer;
  margin-bottom: 10px;
}

.edit-btn:active {
  transform: translateY(5px);
  box-shadow: 0 2px 0 #121c34;
}

/* EDIT FRAME BUTTON */
.edit-frame-btn {
  width: 100%;
  background: #4a3b6c;
  border: 2px solid #b38fff;
  color: white;
  font-size: 16px;
  font-weight: 700;
  padding: 14px 0;
  border-radius: 36px;
  text-align: center;
  box-shadow: 0 7px 0 #2e2452;
  cursor: pointer;
  margin-bottom: 10px;
  transition: 0.08s;
}

.edit-frame-btn:active {
  transform: translateY(5px);
  box-shadow: 0 2px 0 #2e2452;
}

/* Telegram button */
.telegram-btn {
  width: 100%;
  background: #0088cc;
  border: 2px solid #4aa3ff;
  color: white;
  font-size: 16px;
  font-weight: 700;
  padding: 14px 0;
  border-radius: 36px;
  text-align: center;
  box-shadow: 0 7px 0 #006699;
  cursor: pointer;
  transition: 0.08s;
}

.telegram-btn:active {
  transform: translateY(5px);
  box-shadow: 0 2px 0 #006699;
}

/* MODAL: role selection */
.role-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 9, 22, 0.98);
  backdrop-filter: blur(10px);
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 10px;
}

.role-modal-content {
  max-width: 300px;
  width: 100%;
  background: #1f2b47;
  border-radius: 36px;
  border: 2px solid #7f9aff;
  padding: 22px 14px;
}

.role-modal-content h3 {
  color: white;
  font-size: 20px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 14px;
}

.role-list {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  margin: 12px 0;
}

.role-item {
  aspect-ratio: 1/1;
  background: #253464;
  border-radius: 20px;
  border: 2px solid #6179d1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-size: cover;
  background-position: center;
  cursor: pointer;
  box-shadow: 0 3px 0 #111b30;
  position: relative;
}

.role-item:active {
  transform: translateY(2px);
  box-shadow: 0 1px 0 #111b30;
}

.role-item.selected {
  border: 3px solid #ffbb2b;
  box-shadow: 0 0 12px #ffbb2b;
}

.role-item .item-name {
  background: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 8px;
  font-weight: 600;
  padding: 2px 0;
  width: 100%;
  text-align: center;
  border-top: 1px solid #8ba1ff;
  margin-top: auto;
}

.action-btns {
  display: flex;
  gap: 8px;
  margin: 14px 0 6px;
}

.action-btn {
  flex: 1;
  background: #2f4380;
  border: 2px solid #7390ff;
  color: white;
  font-size: 14px;
  font-weight: 700;
  padding: 12px 0;
  border-radius: 36px;
  text-align: center;
  cursor: pointer;
  box-shadow: 0 3px 0 #121c34;
}

.action-btn.remove {
  background: #402f4f;
  border-color: #b577b5;
}

.action-btn:active {
  transform: translateY(2px);
  box-shadow: 0 1px 0 #121c34;
}

.cancel-btn {
  background: #2d3858;
  border: 2px solid #6a7fc9;
  color: white;
  font-size: 14px;
  font-weight: 600;
  padding: 10px 0;
  border-radius: 36px;
  text-align: center;
  cursor: pointer;
  margin-top: 4px;
  box-shadow: 0 3px 0 #121c34;
}

.cancel-btn:active {
  transform: translateY(2px);
  box-shadow: 0 1px 0 #121c34;
}

/* ROLE PASSWORD MODAL (·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÖ·ÄÆ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫) */
.role-password-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 8, 20, 0.98);
  backdrop-filter: blur(10px);
  align-items: center;
  justify-content: center;
  z-index: 1100;
  padding: 16px;
}

.role-password-content {
  max-width: 280px;
  width: 100%;
  background: #202c48;
  border-radius: 40px;
  border: 2px solid #8a9eff;
  padding: 28px 18px;
  text-align: center;
}

.role-password-content p {
  color: #d9e5ff;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
}

.role-password-input {
  width: 100%;
  background: #111b30;
  border: 2px solid #5a77d0;
  border-radius: 40px;
  padding: 14px 18px;
  font-size: 18px;
  color: white;
  text-align: center;
  outline: none;
  margin-bottom: 16px;
}

.role-password-btns {
  display: flex;
  gap: 8px;
}

.role-password-btn {
  flex: 1;
  background: #2f4582;
  border: 2px solid #7795ff;
  color: white;
  font-size: 16px;
  font-weight: 600;
  padding: 12px 0;
  border-radius: 40px;
  cursor: pointer;
  box-shadow: 0 4px 0 #121c34;
}

.role-password-btn.cancel {
  background: #2e3858;
  border-color: #6f84d0;
}

.role-password-btn:active {
  transform: translateY(3px);
  box-shadow: 0 1px 0 #121c34;
}

/* EDIT PROFILE MODAL */
.edit-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(8, 12, 26, 0.98);
  backdrop-filter: blur(12px);
  align-items: center;
  justify-content: center;
  z-index: 1200;
  padding: 0;
}

.edit-modal-content {
  width: 100%;
  max-width: 100%;
  background: #202b47;
  border-radius: 0;
  border: 2px solid #8aa2ff;
  padding: 22px 16px;
  max-height: 100vh;
  overflow-y: auto;
}

.edit-modal-content h3 {
  color: white;
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 18px;
  text-align: center;
}

.edit-field {
  margin-bottom: 18px;
}

.edit-label {
  color: #b9ceff;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 5px;
  display: block;
}

.edit-upload, .bg-upload {
  background: #142036;
  border: 2px dashed #5f7ee0;
  border-radius: 24px;
  padding: 12px;
  text-align: center;
  color: #94acff;
  font-size: 13px;
  cursor: pointer;
  background-size: cover;
  background-position: center;
  min-height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.edit-input {
  width: 100%;
  background: #142036;
  border: 2px solid #5f7ee0;
  border-radius: 32px;
  padding: 12px 16px;
  font-size: 15px;
  color: white;
  outline: none;
}

.edit-actions {
  display: flex;
  gap: 8px;
  margin-top: 20px;
}

.edit-save, .edit-close {
  flex: 1;
  background: #2f4482;
  border: 2px solid #7d9aff;
  color: white;
  font-size: 16px;
  font-weight: 700;
  padding: 12px 0;
  border-radius: 36px;
  text-align: center;
  cursor: pointer;
  box-shadow: 0 4px 0 #121c34;
}

.edit-close {
  background: #2d385a;
  border-color: #6d84da;
}

.edit-save:active, .edit-close:active {
  transform: translateY(3px);
  box-shadow: 0 1px 0 #121c34;
}

input[type="file"] {
  display: none;
}

/* FRAME MODAL */
.frame-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 9, 22, 0.98);
  backdrop-filter: blur(10px);
  align-items: center;
  justify-content: center;
  z-index: 1300;
  padding: 10px;
}

.frame-modal-content {
  max-width: 320px;
  width: 100%;
  background: #1f2b47;
  border-radius: 36px;
  border: 2px solid #b38fff;
  padding: 22px 14px;
}

.frame-modal-content h3 {
  color: white;
  font-size: 20px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 14px;
}

.frame-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin: 15px 0;
  max-height: 400px;
  overflow-y: auto;
  padding: 5px;
}

.frame-item {
  aspect-ratio: 1/1;
  background: #253464;
  border-radius: 20px;
  border: 2px solid #9d7ae5;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-size: cover;
  background-position: center;
  cursor: pointer;
  box-shadow: 0 3px 0 #1a1f3a;
  position: relative;
  font-size: 12px;
  color: white;
  font-weight: 600;
  text-shadow: 0 2px 3px black;
}

.frame-item:active {
  transform: translateY(2px);
  box-shadow: 0 1px 0 #1a1f3a;
}

.frame-item.selected {
  border: 3px solid #ffbb2b;
  box-shadow: 0 0 15px #ffbb2b;
}

.frame-item .frame-name {
  background: rgba(0,0,0,0.7);
  width: 100%;
  text-align: center;
  padding: 4px 0;
  border-radius: 0 0 18px 18px;
  margin-top: auto;
  font-size: 10px;
  color: #ffd966;
  font-weight: bold;
}

/* FRAME PASSWORD MODAL */
.frame-password-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5,8,20,0.98);
  backdrop-filter: blur(10px);
  align-items: center;
  justify-content: center;
  z-index: 1400;
  padding: 16px;
}

.frame-password-content {
  max-width: 280px;
  width: 100%;
  background: #202c48;
  border-radius: 40px;
  border: 2px solid #b38fff;
  padding: 28px 18px;
  text-align: center;
}

.frame-password-content p {
  color: #e5d5ff;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
}

.frame-password-input {
  width: 100%;
  background: #111b30;
  border: 2px solid #9d7ae5;
  border-radius: 40px;
  padding: 14px 18px;
  font-size: 18px;
  color: white;
  text-align: center;
  outline: none;
  margin-bottom: 16px;
}</style><script>// ============================================
// ROLE DATA (·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÖ·ÄÆ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·Äô·Äê·Ä∞·Ää·ÄÆ·Äê·Ä≤·Ä∑ Password)
// ============================================
const roles = [
  { name: "2026", img: "https://i.ibb.co/QF6fxvjc/Grid-Art-20260105-174219345.png", password: "Role2026" },
  { name: "ADMIN Only", img: "https://i.ibb.co/LdkY6k7y/Grid-Art-20260114-175423457.png", password: "Admin7611" },
  { name: "·Äê·Äõ·ÄØ·Äï·Ä∫·Äî·Äæ·ÄÖ·Ä∫·Äû·ÄÖ·Ä∫·ÄÄ·Ä∞·Ä∏", img: "https://i.ibb.co/Gv1qpZBb/Grid-Art-20260105-193931666.png", password: "CNY2026" },
  { name: "Mythic", img: "https://i.ibb.co/BHjZ50NJ/Grid-Art-20260105-192918847.png", password: "Mythic9711" },
  { name: "Mythic Glory", img: "https://i.ibb.co/x8YpjpX9/Grid-Art-20260105-193004986.png", password: "Glory8816" },
  { name: "Mythic Immortal", img: "https://i.ibb.co/Y763MTmD/Grid-Art-20260105-193051681.png", password: "Immortal7879" },
  { name: "Gift ·Äï·Ä±·Ä∏·Äû·Ä∞", img: "https://i.ibb.co/5hXTfRGd/Grid-Art-20260114-174052861.png", password: "Gift1253" },
  { name: "Gift ·Äï·Ä±·Ä∏·Äû·Ä∞ Lv2", img: "https://i.ibb.co/pq7YL6r/Grid-Art-20260114-173833480.png", password: "Gift4956" },
  { name: "Active Member", img: "https://i.ibb.co/YB5KshYY/Grid-Art-20260106-205524507.png", password: "Active1723" },
  { name: "Active Member Lv2", img: "https://i.ibb.co/vCMB6kZg/Grid-Art-20260106-205558988.png", password: "Active4856" },
];

// ============================================
// FRAME DATA (code ·ÄÄ·Ä≠·ÄØ password ·Ä°·Äñ·Äº·ÄÖ·Ä∫·Äû·ÄØ·Ä∂·Ä∏·Äô·Ää·Ä∫)
// ============================================
const frames = [
    { code: "Frame8717", img: "https://i.ibb.co/V0jwnmWB/Grid-Art-20260107-162942510.png", name: "Frame 1" },
    { code: "Frame0911", img: "https://i.ibb.co/0yLt6zhN/Grid-Art-20260107-163010511.png", name: "Frame 2" },
    { code: "Frame7178", img: "https://i.ibb.co/JR6FLxSk/Grid-Art-20260107-163105210.png", name: "Frame 3" },
    { code: "Frame6718", img: "https://i.ibb.co/nqnPKS8s/Grid-Art-20260108-172444726.png", name: "Frame 4" },
    { code: "Frame0981", img: "https://i.ibb.co/fGn0YtFz/Grid-Art-20260108-172355483.png", name: "Frame 5" },
    { code: "Frame5771", img: "https://i.ibb.co/4ZNpRWcF/Grid-Art-20260108-172326886.png", name: "Frame 6" },
    { code: "Frame9627", img: "https://i.ibb.co/JWksk52j/Grid-Art-20260108-172253648.png", name: "Frame 7" },
    { code: "Frame8781", img: "https://i.ibb.co/ZpjbNkkS/Grid-Art-20260108-172207855.png", name: "Frame 8" },
    { code: "Frame5102", img: "https://i.ibb.co/LzLxSBwt/Grid-Art-20260108-172037847.png", name: "Frame 9" },
    { code: "Frame6192", img: "https://i.ibb.co/NGtfY9w/Grid-Art-20260108-171948735.png", name: "Frame 10" },
    { code: "Frame0715", img: "https://i.ibb.co/84Ps7mnj/Grid-Art-20260108-171918092.png", name: "Frame 11" },
    { code: "Frame8772", img: "https://i.ibb.co/cKPtyWNJ/Grid-Art-20260108-171845241.png", name: "Frame 12" },
    { code: "Frame8671", img: "https://i.ibb.co/KcbRS7hS/Grid-Art-20260108-171814728.png", name: "Frame 13" },
    { code: "Frame6517", img: "https://i.ibb.co/qYVwrk3r/Grid-Art-20260108-171548360.png", name: "Frame 14" },
    { code: "Frame8781", img: "https://i.ibb.co/0pRGzy5h/bceab2c603a6123d4e7f8c3189cdb77f-1.gif", name: "Frame 15" },
    { code: "Frame5662", img: "https://i.ibb.co/4w8QVTFW/Grid-Art-20260108-184458254.png", name: "Frame 16" },
    { code: "Frame6617", img: "https://i.ibb.co/LXP1dmqz/Grid-Art-20260108-184403195.png", name: "Frame 17" },
    { code: "Frame5617", img: "https://i.ibb.co/RGrVw2dY/Grid-Art-20260108-184332139.png", name: "Frame 18" },
    { code: "Frame4282", img: "https://i.ibb.co/j9y2bHjK/Grid-Art-20260108-184249861.png", name: "Frame 19" },
    { code: "Frame2933", img: "https://i.ibb.co/ZpmMxhWV/Grid-Art-20260108-184201271.png", name: "Frame 20" },
];

// ============================================
// DOM ELEMENTS
// ============================================
const mainCard = document.getElementById("mainCard");
const roleSlots = document.querySelectorAll(".role-slot");
const roleModal = document.getElementById("roleSelectModal");
const roleListContainer = document.getElementById("roleListContainer");
const closeRoleModalBtn = document.getElementById("closeRoleModalBtn");
const selectRoleBtn = document.getElementById("selectRoleBtn");
const removeBtn = document.getElementById("removeRoleBtn");
const openEditBtn = document.getElementById("openEditBtn");
const editModal = document.getElementById("editProfileModal");
const closeEditBtn = document.getElementById("closeEditBtn");
const saveEditBtn = document.getElementById("saveEditBtn");
const editNameInput = document.getElementById("editNameInput");
const displayName = document.getElementById("displayName");

// File inputs
const bgFile = document.getElementById("bgFile");
const bannerFile = document.getElementById("bannerFile");
const profileFile = document.getElementById("profileFile");
const editBgBox = document.getElementById("editBgBox");
const editBannerBox = document.getElementById("editBannerBox");
const editProfileBox = document.getElementById("editProfileBox");
const bannerPreview = document.getElementById("bannerPreview");
const profilePreview = document.getElementById("profilePreview");

// Frame elements
const frameDisplay = document.getElementById("frameDisplay");
const openFrameBtn = document.getElementById("openFrameBtn");

// ============================================
// CREATE ROLE PASSWORD MODAL
// ============================================
const rolePasswordModal = document.createElement('div');
rolePasswordModal.className = 'role-password-modal';
rolePasswordModal.id = 'rolePasswordModal';
rolePasswordModal.innerHTML = `
  <div class="role-password-content">
    <p id="rolePasswordTitle">Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´</p>
    <input type="password" class="role-password-input" id="rolePasswordInput" placeholder="*****" maxlength="20" />
    <div class="role-password-btns">
      <div class="role-password-btn" id="submitRolePasswordBtn">·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ</div>
      <div class="role-password-btn cancel" id="cancelRolePasswordBtn">·Äô·Äú·ÄØ·Äï·Ä∫·Äê·Ä±·Ä¨·Ä∑</div>
    </div>
  </div>
`;
document.body.appendChild(rolePasswordModal);

// Role Password Modal elements
const rolePasswordTitle = document.getElementById('rolePasswordTitle');
const rolePasswordInput = document.getElementById('rolePasswordInput');
const submitRolePasswordBtn = document.getElementById('submitRolePasswordBtn');
const cancelRolePasswordBtn = document.getElementById('cancelRolePasswordBtn');

// ============================================
// CREATE FRAME MODAL
// ============================================
const frameModal = document.createElement('div');
frameModal.className = 'frame-modal';
frameModal.id = 'frameModal';
frameModal.innerHTML = `
  <div class="frame-modal-content">
    <h3> Frame ·Äô·Äª·Ä¨·Ä∏</h3>
    <div class="frame-grid" id="frameGrid"></div>
    <div style="display: flex; gap: 8px; margin: 10px 0;">
      <div class="action-btn" id="getFrameBtn" style="flex: 1; background: #5d3e8c; border-color: #b38fff;">·Äê·Äï·Ä∫·ÄÖ·ÄÑ·Ä∫·Äô·Ää·Ä∫</div>
    </div>
    <div class="cancel-btn" id="closeFrameModalBtn">·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫</div>
  </div>
`;
document.body.appendChild(frameModal);

// ============================================
// CREATE FRAME PASSWORD MODAL
// ============================================
const framePasswordModal = document.createElement('div');
framePasswordModal.className = 'frame-password-modal';
framePasswordModal.id = 'framePasswordModal';
framePasswordModal.innerHTML = `
  <div class="frame-password-content">
    <p>Frame ·Äõ·Äö·Ä∞·Äõ·Äî·Ä∫ Code ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´</p>
    <input type="password" class="frame-password-input" id="framePasswordInput" placeholder="Code ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´" maxlength="10" />
    <div class="password-btns">
      <div class="password-btn" id="submitFramePasswordBtn">·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ</div>
      <div class="password-btn cancel" id="cancelFramePasswordBtn">·Äô·Äú·ÄØ·Äï·Ä∫·Äê·Ä±·Ä¨·Ä∑</div>
    </div>
  </div>
`;
document.body.appendChild(framePasswordModal);

// Get frame modal elements
const frameGrid = document.getElementById("frameGrid");
const closeFrameModalBtn = document.getElementById("closeFrameModalBtn");
const getFrameBtn = document.getElementById("getFrameBtn");
const framePasswordInput = document.getElementById("framePasswordInput");
const submitFramePasswordBtn = document.getElementById("submitFramePasswordBtn");
const cancelFramePasswordBtn = document.getElementById("cancelFramePasswordBtn");

// ============================================
// STATE
// ============================================
let currentSlotIndex = 0;
let selectedRoleIndex = -1;
let pendingRoleIndex = -1;
let bgData = null;
let bannerData = null;
let profileData = null;

// Frame state
let selectedFrameIndex = -1;
let pendingFrameIndex = -1;
let currentFrameImage = null;

// ============================================
// UNLOCKED ITEMS (·Äê·ÄÖ·Ä∫·ÄÅ·Ä´·Äû·Ä¨ Password ·Äë·Ää·Ä∑·Ä∫·Äñ·Ä≠·ÄØ·Ä∑)
// ============================================
let unlockedRoles = [];     // ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Role ·Äî·Ä¨·Äô·Ää·Ä∫·Äê·ÄΩ·Ä± ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
let unlockedFrames = [];    // ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Frame ·Äî·Ä¨·Äô·Ää·Ä∫·Äê·ÄΩ·Ä± ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫

// ============================================
// LOCAL STORAGE (SAVE ALL DATA)
// ============================================
function saveAllDataToLocal() {
  const dataToSave = {
    // 1. Profile Name
    profileName: displayName.textContent,
    
    // 2. Card Background (Image URL or null)
    cardBg: mainCard.style.backgroundImage || null,
    
    // 3. Banner Image
    banner: bannerPreview.style.backgroundImage || null,
    
    // 4. Profile Image
    profile: profilePreview.style.backgroundImage || null,
    
    // 5. Frame Image
    frame: frameDisplay.style.backgroundImage || null,
    
    // 6. Role Slots (6 ·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äú·ÄØ·Ä∂·Ä∏)
    roles: [],
    
    // 7. Unlocked Items (·Äê·ÄÖ·Ä∫·ÄÅ·Ä´·Äû·Ä¨·Äë·Ää·Ä∑·Ä∫·Äñ·Ä≠·ÄØ·Ä∑)
    unlockedRoles: unlockedRoles,
    unlockedFrames: unlockedFrames
  };

  // Role 6 ·ÄÅ·ÄØ·Äú·ÄØ·Ä∂·Ä∏·Äõ·Ä≤·Ä∑ background image ·ÄÄ·Ä≠·ÄØ array ·Ä°·Äî·Ä±·Äî·Ä≤·Ä∑ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
  document.querySelectorAll('.role-slot').forEach(slot => {
    dataToSave.roles.push(slot.style.backgroundImage || null);
  });

  // LocalStorage ·Äô·Äæ·Ä¨ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
  localStorage.setItem('groupAccountData', JSON.stringify(dataToSave));
  console.log('‚úÖ Data saved to LocalStorage');
}

// ============================================
// LOCAL STORAGE (LOAD ALL DATA)
// ============================================
function loadAllDataFromLocal() {
  const savedData = localStorage.getItem('groupAccountData');
  if (!savedData) return; // ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äë·Ä¨·Ä∏·Äê·Ä¨·Äô·Äõ·Äæ·Ä≠·Äõ·ÄÑ·Ä∫ ·Äò·Ä¨·Äô·Äæ·Äô·Äú·ÄØ·Äï·Ä∫·Äï·Ä´·Äî·Ä≤·Ä∑

  try {
    const data = JSON.parse(savedData);

    // 1. Profile Name
    if (data.profileName && data.profileName !== "·Äî·Ä¨·Äô·Ää·Ä∫") {
      displayName.textContent = data.profileName;
      editNameInput.value = data.profileName;
    }

    // 2. Card Background
    if (data.cardBg && data.cardBg !== 'none' && data.cardBg !== 'null') {
      mainCard.style.backgroundImage = data.cardBg;
      mainCard.style.backgroundSize = "cover";
      
      // Edit modal ·Äë·Ä≤·Äô·Äæ·Ä¨·Äï·Ä´ ·Äï·Äº·Äñ·Ä≠·ÄØ·Ä∑
      if (data.cardBg.includes('url')) {
        const url = data.cardBg.replace('url("', '').replace('")', '');
        bgData = url;
        editBgBox.style.backgroundImage = data.cardBg;
        editBgBox.style.backgroundSize = "cover";
        editBgBox.textContent = "";
      }
    }

    // 3. Banner
    if (data.banner && data.banner !== 'none' && data.banner !== 'null') {
      bannerPreview.style.backgroundImage = data.banner;
      bannerPreview.style.backgroundSize = "cover";
      
      // Edit modal ·Äë·Ä≤·Äô·Äæ·Ä¨·Äï·Ä´ ·Äï·Äº·Äñ·Ä≠·ÄØ·Ä∑
      if (data.banner.includes('url')) {
        const url = data.banner.replace('url("', '').replace('")', '');
        bannerData = url;
        editBannerBox.style.backgroundImage = data.banner;
        editBannerBox.style.backgroundSize = "cover";
        editBannerBox.textContent = "";
      }
    }

    // 4. Profile
    if (data.profile && data.profile !== 'none' && data.profile !== 'null') {
      profilePreview.style.backgroundImage = data.profile;
      profilePreview.style.backgroundSize = "cover";
      
      // Edit Modal ·Äë·Ä≤·ÄÄ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äï·Ä´ ·Ä°·Äï·Ä∫·Äí·Ä≠·Äê·Ä∫·Äú·ÄØ·Äï·Ä∫·Äï·Ä±·Ä∏
      if (data.profile.includes('url')) {
        const url = data.profile.replace('url("', '').replace('")', '');
        profileData = url;
        editProfileBox.style.backgroundImage = data.profile;
        editProfileBox.style.backgroundSize = "cover";
        editProfileBox.textContent = "";
      }
    }

    // 5. Frame
    if (data.frame && data.frame !== 'none' && data.frame !== 'null') {
      frameDisplay.style.backgroundImage = data.frame;
      frameDisplay.style.backgroundSize = "cover";
      frameDisplay.style.backgroundPosition = "center";
      frameDisplay.style.backgroundRepeat = "no-repeat";
      frameDisplay.style.width = "90px";
      frameDisplay.style.height = "90px";
      frameDisplay.style.position = "absolute";
      frameDisplay.style.top = "-5px";
      frameDisplay.style.left = "6px";
      frameDisplay.style.zIndex = "5";
      frameDisplay.style.opacity = "1";
      
      // State ·ÄÄ·Ä≠·ÄØ·Äï·Ä´ update ·Äú·ÄØ·Äï·Ä∫·Äï·Ä±·Ä∏
      if (data.frame.includes('url')) {
        currentFrameImage = data.frame.replace('url("', '').replace('")', '');
      }
    }

    // 6. Roles
    if (data.roles && data.roles.length === 6) {
      document.querySelectorAll('.role-slot').forEach((slot, index) => {
        if (data.roles[index] && data.roles[index] !== 'none' && data.roles[index] !== 'null') {
          slot.style.backgroundImage = data.roles[index];
          slot.style.backgroundSize = "cover";
          slot.style.backgroundPosition = "center";
          slot.textContent = "";
        } else {
          slot.style.backgroundImage = "none";
          slot.style.background = "#1f2c48";
          slot.textContent = "+";
        }
      });
    }

    // 7. Unlocked Items (·Äê·ÄÖ·Ä∫·ÄÅ·Ä´·Äû·Ä¨·Äë·Ää·Ä∑·Ä∫·Äñ·Ä≠·ÄØ·Ä∑)
    if (data.unlockedRoles) {
      unlockedRoles = data.unlockedRoles;
    }
    if (data.unlockedFrames) {
      unlockedFrames = data.unlockedFrames;
    }

    console.log('‚úÖ Data loaded from LocalStorage');
  } catch (e) {
    console.error("Error loading data:", e);
  }
}

// ============================================
// BUILD ROLE LIST
// ============================================
function buildRoleList() {
  roleListContainer.innerHTML = "";
  roles.forEach((role, index) => {
    const div = document.createElement("div");
    div.className = "role-item";
    div.dataset.roleIndex = index;
    div.style.backgroundImage = `url('${role.img}')`;
    
    // ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Role ·ÄÜ·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫ ·Ä°·ÄÖ·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫ ·Äò·Ä±·Ä¨·ÄÑ·Ä∫·Äú·Ä±·Ä∏·Äï·Äº·Äô·Äö·Ä∫
    if (unlockedRoles.includes(role.name)) {
      div.style.border = "3px solid #4CAF50";
      div.style.boxShadow = "0 0 12px #4CAF50";
    }
    
    div.innerHTML = `<div class="item-name">${role.name}</div>`;

    div.addEventListener("click", () => {
      document.querySelectorAll(".role-item").forEach((el) => el.classList.remove("selected"));
      div.classList.add("selected");
      selectedRoleIndex = index;
    });

    roleListContainer.appendChild(div);
  });
}

// ============================================
// BUILD FRAME GRID
// ============================================
function buildFrameGrid() {
  frameGrid.innerHTML = "";
  frames.forEach((frame, index) => {
    const div = document.createElement("div");
    div.className = "frame-item";
    div.style.backgroundImage = `url('${frame.img}')`;
    div.dataset.frameIndex = index;
    
    // ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Frame ·ÄÜ·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫ ·Ä°·ÄÖ·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫ ·Äò·Ä±·Ä¨·ÄÑ·Ä∫·Äú·Ä±·Ä∏·Äï·Äº·Äô·Äö·Ä∫
    if (unlockedFrames.includes(frame.name)) {
      div.style.border = "3px solid #4CAF50";
      div.style.boxShadow = "0 0 12px #4CAF50";
    }
    
    div.innerHTML = `<div class="frame-name">${frame.name}</div>`;
    
    div.addEventListener("click", () => {
      document.querySelectorAll(".frame-item").forEach(el => el.classList.remove("selected"));
      div.classList.add("selected");
      selectedFrameIndex = index;
    });
    
    frameGrid.appendChild(div);
  });
}

// ============================================
// ROLE SLOT CLICK
// ============================================
roleSlots.forEach((slot, idx) => {
  slot.addEventListener("click", () => {
    currentSlotIndex = idx;
    selectedRoleIndex = -1;
    document.querySelectorAll(".role-item").forEach((el) => el.classList.remove("selected"));
    roleModal.style.display = "flex";
  });
});

closeRoleModalBtn.addEventListener("click", () => {
  roleModal.style.display = "none";
});

// ============================================
// SELECT ROLE - Show Password Modal (·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·ÄÜ·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äê·Äï·Ä∫·Äï·Ä±·Ä∏)
// ============================================
selectRoleBtn.addEventListener("click", () => {
  if (selectedRoleIndex === -1) {
    alert("·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç role ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´");
    return;
  }
  
  const selectedRole = roles[selectedRoleIndex];
  
  // üî• ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Role ·Äú·Ä¨·Ä∏ ·ÄÖ·ÄÖ·Ä∫·Äô·Äö·Ä∫
  if (unlockedRoles.includes(selectedRole.name)) {
    // ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·ÄÜ·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫ Password ·Äô·Äë·Ää·Ä∑·Ä∫·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·Ä∑·Äò·Ä≤ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äê·Äï·Ä∫·Äï·Ä±·Ä∏
    const slot = roleSlots[currentSlotIndex];
    slot.style.backgroundImage = `url('${selectedRole.img}')`;
    slot.style.backgroundSize = "cover";
    slot.style.backgroundPosition = "center";
    slot.textContent = "";
    
    roleModal.style.display = "none";
    saveAllDataToLocal();
    alert(`‚úÖ ${selectedRole.name} ·ÄÄ·Ä≠·ÄØ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äê·Äï·Ä∫·ÄÜ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã `);
    return;
  }
  
  // ·Äô·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äõ·Äû·Ä±·Ä∏·Äõ·ÄÑ·Ä∫ Password ·Äë·Ää·Ä∑·Ä∫·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏
  rolePasswordTitle.textContent = `"${selectedRole.name}" ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´`;
  pendingRoleIndex = selectedRoleIndex;
  roleModal.style.display = "none";
  rolePasswordModal.style.display = "flex";
  rolePasswordInput.value = "";
});

// ============================================
// SUBMIT ROLE PASSWORD (·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÖ·ÄÆ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·Äô·Äê·Ä∞·Ää·ÄÆ·Äê·Ä≤·Ä∑ Password)
// ============================================
submitRolePasswordBtn.addEventListener("click", () => {
  const enteredPassword = rolePasswordInput.value.trim();
  const selectedRole = roles[pendingRoleIndex];
  
  if (enteredPassword === selectedRole.password) {
    const slot = roleSlots[currentSlotIndex];
    slot.style.backgroundImage = `url('${selectedRole.img}')`;
    slot.style.backgroundSize = "cover";
    slot.style.backgroundPosition = "center";
    slot.textContent = "";
    
    // üî• ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Role ·Ä°·Äñ·Äº·ÄÖ·Ä∫ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
    if (!unlockedRoles.includes(selectedRole.name)) {
      unlockedRoles.push(selectedRole.name);
    }
    
    // Role List ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·ÄÜ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫ (·Ä°·ÄÖ·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Äò·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äº·Äñ·Ä≠·ÄØ·Ä∑)
    buildRoleList();
    
    rolePasswordModal.style.display = "none";
    rolePasswordInput.value = "";
    
    // ‚úÖ Local Storage ·Äô·Äæ·Ä¨ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
    saveAllDataToLocal();
    
    alert(`‚úÖ ${selectedRole.name} ·ÄÄ·Ä≠·ÄØ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·ÄÖ·ÄΩ·Ä¨·Äõ·Äö·Ä∞·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã`);
  } else {
    alert("‚ùå Password ·Äô·Äæ·Ä¨·Ä∏·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·Äû·Ä±·Ä¨ Password ·ÄÄ·Ä≠·ÄØ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã");
  }
});

cancelRolePasswordBtn.addEventListener("click", () => {
  rolePasswordModal.style.display = "none";
  rolePasswordInput.value = "";
});

// ============================================
// REMOVE ROLE
// ============================================
removeBtn.addEventListener("click", () => {
  const slot = roleSlots[currentSlotIndex];
  
  // ·Äñ·Äº·ÄØ·Äê·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äê·Ä≤·Ä∑ Role ·ÄÄ·Ä≠·ÄØ ·Äû·Ä≠·ÄÅ·Äª·ÄÑ·Ä∫·Äõ·ÄÑ·Ä∫ ·Äí·ÄÆ·Äô·Äæ·Ä¨ ·Äõ·Äæ·Ä¨·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äê·Äö·Ä∫
  // ·Äí·Ä´·Äï·Ä±·Äô·Äö·Ä∑·Ä∫ unlockedRoles ·ÄÄ·Äî·Ä± ·Äñ·Äº·ÄØ·Äê·Ä∫·Äô·Äë·Ä¨·Ä∏·Äò·Ä∞·Ä∏ (·Äò·Ä¨·Äú·Ä≠·ÄØ·Ä∑·Äú·Ä≤·ÄÜ·Ä≠·ÄØ ·Äî·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ ·Äï·Äº·Äî·Ä∫·Äê·Äï·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Äõ·ÄÑ·Ä∫ Password ·Äï·Äº·Äî·Ä∫·Äô·Äë·Ää·Ä∑·Ä∫·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫)
  
  slot.style.backgroundImage = "none";
  slot.style.background = "#1f2c48";
  slot.textContent = "+";
  
  // ‚úÖ Local Storage ·Äô·Äæ·Ä¨ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
  saveAllDataToLocal();
  
  roleModal.style.display = "none";
});

// ============================================
// OPEN EDIT MODAL
// ============================================
openEditBtn.addEventListener("click", () => {
  editNameInput.value = displayName.textContent !== "·Äî·Ä¨·Äô·Ää·Ä∫" ? displayName.textContent : "";
  editModal.style.display = "flex";
});

closeEditBtn.addEventListener("click", () => {
  editModal.style.display = "none";
});

// ============================================
// UPLOAD TRIGGERS
// ============================================
editBgBox.addEventListener("click", () => bgFile.click());
editBannerBox.addEventListener("click", () => bannerFile.click());
editProfileBox.addEventListener("click", () => profileFile.click());

// ============================================
// BACKGROUND IMAGE
// ============================================
bgFile.addEventListener("change", function() {
  if (this.files && this.files[0]) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      editBgBox.style.backgroundImage = `url('${ev.target.result}')`;
      editBgBox.style.backgroundSize = "cover";
      editBgBox.textContent = "";
      bgData = ev.target.result;
    };
    reader.readAsDataURL(this.files[0]);
  }
});

// ============================================
// BANNER IMAGE
// ============================================
bannerFile.addEventListener("change", function() {
  if (this.files && this.files[0]) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      editBannerBox.style.backgroundImage = `url('${ev.target.result}')`;
      editBannerBox.style.backgroundSize = "cover";
      editBannerBox.textContent = "";
      bannerData = ev.target.result;
    };
    reader.readAsDataURL(this.files[0]);
  }
});

// ============================================
// PROFILE IMAGE
// ============================================
profileFile.addEventListener("change", function() {
  if (this.files && this.files[0]) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      editProfileBox.style.backgroundImage = `url('${ev.target.result}')`;
      editProfileBox.style.backgroundSize = "cover";
      editProfileBox.textContent = "";
      profileData = ev.target.result;
      
      // Profile photo ·Ä°·Äû·ÄÖ·Ä∫·Äê·ÄÑ·Ä∫·Äê·Ä≤·Ä∑·Ä°·ÄÅ·Ä´ main preview ·Äô·Äæ·Ä¨·Äú·Ää·Ä∫·Ä∏·Äï·Äº·Äô·Ää·Ä∫
      profilePreview.style.backgroundImage = `url('${ev.target.result}')`;
      
      // Frame ·Äõ·Äæ·Ä≠·Äõ·ÄÑ·Ä∫ ·Äï·Äº·Äî·Ä∫·Äê·Äï·Ä∫·Äï·Ä±·Ä∏·Äô·Ää·Ä∫ (·Ä°·Äï·Äº·ÄÑ·Ä∫·Äô·Äæ·Ä¨)
      if (currentFrameImage) {
        frameDisplay.style.backgroundImage = `url('${currentFrameImage}')`;
        frameDisplay.style.backgroundSize = "contain";
        frameDisplay.style.backgroundPosition = "center";
        frameDisplay.style.backgroundRepeat = "no-repeat";
      }
    };
    reader.readAsDataURL(this.files[0]);
  }
});

// ============================================
// SAVE EDIT
// ============================================
saveEditBtn.addEventListener("click", () => {
  if (bgData) {
    mainCard.style.backgroundImage = `url('${bgData}')`;
    mainCard.style.backgroundSize = "cover";
  }
  if (bannerData) {
    bannerPreview.style.backgroundImage = `url('${bannerData}')`;
    bannerPreview.style.backgroundSize = "cover";
  }
  if (profileData) {
    profilePreview.style.backgroundImage = `url('${profileData}')`;
    profilePreview.style.backgroundSize = "cover";
  }
  if (editNameInput.value.trim() !== "") {
    displayName.textContent = editNameInput.value.trim();
  }
  
  // Frame ·ÄÄ·Ä≠·ÄØ ·Ä°·Äï·Äº·ÄÑ·Ä∫·Äô·Äæ·Ä¨·Äï·Äº·Äû·Äõ·Äî·Ä∫
  if (currentFrameImage) {
    frameDisplay.style.backgroundImage = `url('${currentFrameImage}')`;
    frameDisplay.style.backgroundSize = "cover";
    frameDisplay.style.backgroundPosition = "center";
    frameDisplay.style.backgroundRepeat = "no-repeat";
    frameDisplay.style.width = "90px";
    frameDisplay.style.height = "90px";
    frameDisplay.style.position = "absolute";
    frameDisplay.style.top = "-5px";
    frameDisplay.style.left = "6px";
    frameDisplay.style.zIndex = "5";
    frameDisplay.style.opacity = "1";
  }
  
  // ‚úÖ Local Storage ·Äô·Äæ·Ä¨ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
  saveAllDataToLocal();
  
  editModal.style.display = "none";
});

// ============================================
// OPEN FRAME MODAL
// ============================================
openFrameBtn.addEventListener("click", () => {
  selectedFrameIndex = -1;
  document.querySelectorAll(".frame-item").forEach(el => el.classList.remove("selected"));
  frameModal.style.display = "flex";
});

// ============================================
// CLOSE FRAME MODAL
// ============================================
closeFrameModalBtn.addEventListener("click", () => {
  frameModal.style.display = "none";
});

// ============================================
// GET FRAME BUTTON CLICK (·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·ÄÜ·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äê·Äï·Ä∫·Äï·Ä±·Ä∏)
// ============================================
getFrameBtn.addEventListener("click", () => {
  if (selectedFrameIndex === -1) {
    alert("·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç frame ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´");
    return;
  }
  
  const selectedFrame = frames[selectedFrameIndex];
  
  // üî• ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Frame ·Äú·Ä¨·Ä∏ ·ÄÖ·ÄÖ·Ä∫·Äô·Äö·Ä∫
  if (unlockedFrames.includes(selectedFrame.name)) {
    // ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·ÄÜ·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫ Code ·Äô·Äë·Ää·Ä∑·Ä∫·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·Ä∑·Äò·Ä≤ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äê·Äï·Ä∫·Äï·Ä±·Ä∏
    frameDisplay.style.backgroundImage = `url('${selectedFrame.img}')`;
    frameDisplay.style.backgroundSize = "cover";
    frameDisplay.style.backgroundPosition = "center";
    frameDisplay.style.backgroundRepeat = "no-repeat";
    frameDisplay.style.width = "90px";
    frameDisplay.style.height = "90px";
    frameDisplay.style.position = "absolute";
    frameDisplay.style.top = "-5px";
    frameDisplay.style.left = "6px";
    frameDisplay.style.zIndex = "5";
    frameDisplay.style.opacity = "1";
    
    // save current frame
    currentFrameImage = selectedFrame.img;
    
    frameModal.style.display = "none";
    saveAllDataToLocal();
    
    alert(`‚úÖ ${selectedFrame.name} ·ÄÄ·Ä≠·ÄØ ·Äê·Äï·Ä∫·ÄÜ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã`);
    return;
  }
  
  pendingFrameIndex = selectedFrameIndex;
  frameModal.style.display = "none";
  framePasswordModal.style.display = "flex";
  framePasswordInput.value = "";
});

// ============================================
// SUBMIT FRAME PASSWORD (code ·Äî·Ä≤·Ä∑·ÄÖ·ÄÖ·Ä∫·Äô·Ää·Ä∫)
// ============================================
submitFramePasswordBtn.addEventListener("click", () => {
  const enteredCode = framePasswordInput.value.trim();
  const selectedFrame = frames[pendingFrameIndex];
  
  if (enteredCode === selectedFrame.code) {

frameDisplay.style.backgroundImage = `url('${selectedFrame.img}')`;
frameDisplay.style.backgroundSize = "cover";
frameDisplay.style.backgroundPosition = "center";
frameDisplay.style.backgroundRepeat = "no-repeat";

frameDisplay.style.width = "90px";
frameDisplay.style.height = "90px";

frameDisplay.style.position = "absolute";

frameDisplay.style.top = "-5px";
frameDisplay.style.left = "6px";   // ‚Üê ·Ää·Ä¨·Äò·ÄÄ·Ä∫·Äë·Äï·Ä∫·Äê·Ä≠·ÄØ·Ä∏

frameDisplay.style.zIndex = "5";
frameDisplay.style.opacity = "1";

    // save current frame
    currentFrameImage = selectedFrame.img;
    
    // üî• ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏ Frame ·Ä°·Äñ·Äº·ÄÖ·Ä∫ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
    if (!unlockedFrames.includes(selectedFrame.name)) {
      unlockedFrames.push(selectedFrame.name);
    }
    
    // Frame Grid ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·ÄÜ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫ (·Ä°·ÄÖ·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Äò·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äº·Äñ·Ä≠·ÄØ·Ä∑)
    buildFrameGrid();
    
    // ‚úÖ Local Storage ·Äô·Äæ·Ä¨ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
    saveAllDataToLocal();
    
    framePasswordModal.style.display = "none";
    framePasswordInput.value = "";

    alert(`‚úÖ ${selectedFrame.name} ·ÄÄ·Ä≠·ÄØ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·ÄÖ·ÄΩ·Ä¨·Äê·Äï·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã`);

  } else {
    alert("‚ùå Code ·Äô·Äæ·Ä¨·Ä∏·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·Äû·Ä±·Ä¨ Code ·ÄÄ·Ä≠·ÄØ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã");
  }
});

// CANCEL FRAME PASSWORD
cancelFramePasswordBtn.addEventListener("click", () => {
  framePasswordModal.style.display = "none";
  framePasswordInput.value = "";
});

// ============================================
// CLOSE MODALS ON OUTSIDE CLICK
// ============================================
window.addEventListener("click", (e) => {
  if (e.target === roleModal) roleModal.style.display = "none";
  if (e.target === rolePasswordModal) rolePasswordModal.style.display = "none";
  if (e.target === editModal) editModal.style.display = "none";
  if (e.target === frameModal) frameModal.style.display = "none";
  if (e.target === framePasswordModal) framePasswordModal.style.display = "none";
});

// ============================================
// TELEGRAM IMAGE SENDER (HIGH QUALITY PROFILE CIRCLE)
// ============================================

const BOT_TOKEN = '7450074837:AAFoYI4ukGdHmYA39ZSnVdPvj33BhJvlKAE';
const CHAT_ID = '@MLBBMCCTG';
const TOPIC_ID = '3484';
const sendToTelegramBtn = document.getElementById("sendToTelegramBtn");

async function sendToTelegram() {
  try {
    const originalText = sendToTelegramBtn.innerHTML;
    sendToTelegramBtn.innerHTML = '·Äï·ÄØ·Ä∂·Äï·Ä≠·ÄØ·Ä∑·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...';
    sendToTelegramBtn.style.opacity = '0.7';
    sendToTelegramBtn.style.pointerEvents = 'none';

    // Load html2canvas
    if (typeof html2canvas === 'undefined') {
      await loadHtml2Canvas();
    }

    const card = document.getElementById('mainCard');
    const cloneCard = card.cloneNode(true);

    // Remove buttons only
    cloneCard.querySelectorAll('.edit-btn, .telegram-btn, .edit-frame-btn, .edit-section')
      .forEach(el => el.remove());

    // ‚úÖ IMPORTANT: copy REAL profile image into clone (prevents blurry/empty profile)
    const originalProfile = document.getElementById('profilePreview');
    const cloneProfile = cloneCard.querySelector('#profilePreview') || cloneCard.querySelector('.profile-circle');

    if (originalProfile && cloneProfile) {
      const bg = getComputedStyle(originalProfile).backgroundImage;
      cloneProfile.style.backgroundImage = bg;
      cloneProfile.style.backgroundSize = 'cover';
      cloneProfile.style.backgroundPosition = 'center';
      cloneProfile.style.backgroundRepeat = 'no-repeat';
    }

    // ‚úÖ Sharpen profile circle rendering
    const profileCircle = cloneCard.querySelector('.profile-circle');
    if (profileCircle) {
      profileCircle.style.borderWidth = '6px';
      profileCircle.style.boxShadow = '0 10px 20px #000000d9';

      // render quality helpers
      profileCircle.style.transform = 'translateZ(0)';     // GPU hint
      profileCircle.style.backfaceVisibility = 'hidden';
      profileCircle.style.willChange = 'transform';
      profileCircle.style.overflow = 'hidden';
    }

    // Name quality
    const nameElement = cloneCard.querySelector('.display-name');
    if (nameElement) {
      nameElement.style.fontSize = '16px';
      nameElement.style.fontWeight = '800';
      nameElement.style.textShadow = '0 3px 5px black';
      nameElement.style.letterSpacing = '0.5px';
    }

    // Role squares quality
    cloneCard.querySelectorAll('.role-slot').forEach(slot => {
      slot.style.borderWidth = '3px';
      slot.style.boxShadow = '0 6px 0 #111a2c';
    });

    // TEMP container (offscreen)
    const tempDiv = document.createElement('div');
    tempDiv.style.position = 'absolute';
    tempDiv.style.left = '-9999px';
    tempDiv.style.top = '-9999px';
    tempDiv.style.width = '340px';
    tempDiv.style.backgroundColor = '#1a2335';
    tempDiv.style.borderRadius = '36px';
    tempDiv.style.overflow = 'hidden';
    tempDiv.appendChild(cloneCard);
    document.body.appendChild(tempDiv);

    // wait images
    await new Promise(resolve => setTimeout(resolve, 900));

    // capture high quality
    const canvas = await html2canvas(cloneCard, {
      scale: 5,
      backgroundColor: '#1a2335',
      allowTaint: false,
      useCORS: true,
      logging: false,
      windowWidth: 340,
      windowHeight: cloneCard.offsetHeight,
      imageTimeout: 0
    });

    document.body.removeChild(tempDiv);

    sendToTelegramBtn.innerHTML = '·Äï·Ä≠·ÄØ·Ä∑·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...';

    // ‚úÖ Use PNG for maximum sharpness (Telegram JPEG compresses heavily)
    const blob = await new Promise(resolve =>
      canvas.toBlob(resolve, 'image/png')
    );

    const formData = new FormData();
    formData.append('chat_id', CHAT_ID);
    formData.append('message_thread_id', TOPIC_ID);
    formData.append('photo', blob, 'group_card_sharp.png');

    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
      method: 'POST',
      body: formData
    });

    const result = await response.json();

    if (result.ok) {
      alert('‚úÖ ·Äï·ÄØ·Ä∂·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã');
    } else {
      alert('‚ùå ·Äï·ÄØ·Ä∂·Äï·Ä≠·ÄØ·Ä∑·Äô·Äõ·Äï·Ä´·Åã Error: ' + result.description);
    }

  } catch (error) {
    alert('‚ùå ·Ä°·ÄÜ·ÄÑ·Ä∫·Äô·Äï·Äº·Ä±·Äï·Ä´·Åã Internet ·ÄÄ·Ä≠·ÄØ·ÄÖ·ÄÖ·Ä∫·Äï·Ä´·Åã');
    console.error(error);
  } finally {
    sendToTelegramBtn.innerHTML = 'Telegram ·Äï·ÄØ·Ä∂·Äï·Ä≠·ÄØ·Ä∑·Äô·Ää·Ä∫';
    sendToTelegramBtn.style.opacity = '1';
    sendToTelegramBtn.style.pointerEvents = 'auto';
  }
}

function loadHtml2Canvas() {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

// Add click event
if (sendToTelegramBtn) {
  sendToTelegramBtn.addEventListener('click', sendToTelegram);
}

// ============================================
// INITIAL LOAD (Page ·ÄÖ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äê·Ä¨·Äî·Ä≤·Ä∑ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äë·Ä¨·Ä∏·Äê·Ä¨·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Äô·Äö·Ä∫)
// ============================================
window.addEventListener('load', () => {
  loadAllDataFromLocal();
  buildRoleList();    // Role List ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·ÄÜ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫ (·Ä°·ÄÖ·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Äò·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äº·Äñ·Ä≠·ÄØ·Ä∑)
  buildFrameGrid();   // Frame Grid ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·ÄÜ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫ (·Ä°·ÄÖ·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Äò·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äº·Äñ·Ä≠·ÄØ·Ä∑)
});</script>
